<!DOCTYPE html>
<html>
	<head>
		<title>Chromecast Receiver</title>
		<meta charset="utf-8"/>
		<link rel="stylesheet" href="main.css"/>
		<!--link href="https://fonts.googleapis.com/css?family=Over+the+Rainbow" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Ballet" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet"-->
		<!--style id="verseStyle">
		/* CSS styles for the text message */
		.welcomme {
		  position: absolute;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  #font-size: 36px;
		  #font-weight: bold;
		  color: #ffffff;
		  background-color: rgba(0, 0, 0, 0);
		  z-index: 999;
		}

		.verse.v1, .verse.v2, .verse.v4, .verse.v5, .verse.v7, .verse.v9 {
			display: initial !important;
		}
		</style-->
	</head>
	<body>
		<!-- The video player -->
		<!--video id="video">controls autoplay</video-->
		<!--cast-media-player style="display: none"></cast-media-player-->
		<cast-media-player style="opacity: 0"></cast-media-player>
		<!--cast-media-player></cast-media-player-->
		<div id="splash" class="dimable">
			<object data="backgrounds/intro.html" style="width:100%;height:100vh;"></object>
			<div id="welcome" class="centered fit">
				<h1 id="title">VerseCast</h1>
				<p id="message">Loading...</p>
			</div>
		</div>
		<object id="background" data="backgrounds/black.html" class="dimable" style="width:100%;height:100vh;"></object>
		<div id="announcements" class="dimable">
			<div id="announcement" class="fit sizable">
				<h1>Title</h1>
				<ul>
					<li>First item</li>
					<li>Second item</li>
					<li>Third item</li>
				</ul>
			</div>
			<div id="footer">
				<span class="demoText hidden">VerseCast for Chromecast</span>
				<span/>
			</div>
		</div>
		<div id="verses" class="dimable">
			<div id="verse" class="centered fit sizable">
				<div class="version vid464 iso6393slk" data-vid="464" data-iso6393="slk">
					<div class="book bkPSA">
						<div class="chapter ch28" data-usfm="PSA.28">
							<div class="label">28</div>
							<div class="s1">
								<span class="heading">Hospodin, volám k tebe!</span>
							</div>
							<div class="d">
								<span class="content">  </span>
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="label">1</span>
									<span class="content">Dávidov.</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="content">Hospodin, volám k tebe!</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="content">Skala moja, nemlč!</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="content">Ak budeš mlčať, budem sa podobať tým,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="content">čo zostupujú do hrobu.</span>
									<span class="note x">
										<span class="label">#</span>
										<span class=" body">Ž 143,7</span>
									</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v1" data-usfm="PSA.28.1">
									<span class="content">  </span>
								</span>
								<span class="verse v2" data-usfm="PSA.28.2">
									<span class="label">2</span>
									<span class="content">Počuj môj úpenlivý hlas,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v2" data-usfm="PSA.28.2">
									<span class="content">keď volám k tebe o pomoc</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v2" data-usfm="PSA.28.2">
									<span class="content">a spínam ruky k tvojej veľsvätyni.</span>
									<span class="note x">
										<span class="label">#</span>
										<span class=" body">Ž 31,23; 141,2</span>
									</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v2" data-usfm="PSA.28.2">
									<span class="content">  </span>
								</span>
								<span class="verse v3" data-usfm="PSA.28.3">
									<span class="label">3</span>
									<span class="content">Nezaraď ma medzi bezbožníkov</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v3" data-usfm="PSA.28.3">
									<span class="content">a páchateľov bezprávia.</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v3" data-usfm="PSA.28.3">
									<span class="content">S blížnymi sa vľúdne zhovárajú,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v3" data-usfm="PSA.28.3">
									<span class="content">ale v srdci majú zlobu.</span>
									<span class="note x">
										<span class="label">#</span>
										<span class=" body">2Sam 20,9-10</span>
									</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v3" data-usfm="PSA.28.3">
									<span class="content">  </span>
								</span>
								<span class="verse v4" data-usfm="PSA.28.4">
									<span class="label">4</span>
									<span class="content">Nalož s nimi podľa ich skutkov,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v4" data-usfm="PSA.28.4">
									<span class="content">podľa ich zlých činov.</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v4" data-usfm="PSA.28.4">
									<span class="content">Nalož s nimi podľa diela ich rúk,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v4" data-usfm="PSA.28.4">
									<span class="content">odplať im podľa ich zásluh.</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v4" data-usfm="PSA.28.4">
									<span class="content">  </span>
								</span>
								<span class="verse v5" data-usfm="PSA.28.5">
									<span class="label">5</span>
									<span class="content">Oni predsa nechápu skutky Hospodina</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v5" data-usfm="PSA.28.5">
									<span class="content">ani dielo jeho rúk.</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v5" data-usfm="PSA.28.5">
									<span class="content">Zničí ich a neobnoví.</span>
									<span class="note x">
										<span class="label">#</span>
										<span class=" body">Iz 5,12</span>
									</span>
								</span>
							</div>
							<div class="q1">
								<span class="verse v5" data-usfm="PSA.28.5">
									<span class="content">  </span>
								</span>
								<span class="verse v6" data-usfm="PSA.28.6">
									<span class="label">6</span>
									<span class="content">Nech je zvelebený Hospodin,</span>
								</span>
							</div>
							<div class="q2">
								<span class="verse v6" data-usfm="PSA.28.6">
									<span class="content">lebo vypočul moje úpenliv</span>
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="footer">
				<span class="demoText hidden">VerseCast for Chromecast</span>
				<span/>
				<span id="source">Lukáš 19:1‭-‬3 SEBDT</span>
			</div>
		</div>
		<div id="black" class="dimable fit"></div>
		<div id="debug" class="hiddenMy"><div class="fit">Debug</div></div>
		<!-- Include the Cast Receiver SDK -->
		<script type="text/javascript" src="ui.js"></script>
		<script type="text/javascript" src="theme.js"></script>
		<script type="text/javascript" src="http://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
		<!-- Initialize the CastReceiverContext -->
		<script type="text/javascript">
			window.addEventListener('load', function () {
				debug("load finished");
			});
			showDebug();
			debug("Starting...");

			//fadeToVerse();

			// Create a CastReceiverContext
			const context = cast.framework.CastReceiverContext.getInstance();

			//context.setInactivityTimeout(1800000);

			// https://marekhalmo.github.io/index.html
			// http://www.maniacs.sk/cast/index.html

			/*
			// send json like this to display message
			{
			   "media":{
				  "contentId":"bbb",
				  "contentUrl":"https://commondatastorage.googleapis.com/gtv-videos-bucket/CastVideos/mp4/BigBuckBunny.mp4",
				  "entity":"myapp://playlist/1",
				  "streamType":"BUFFERED",
				  "customData":{
					 "verse":"Potom vošiel do Jericha a prechádzal cezeň. A tu bol muž, menom Zachej, ktorý bol hlavným mýtnikom a bol bohatý. Chcel vidieť Ježiša, aby vedel, kto to je, no pre zástupy ho nemohol zazrieť, lebo bol malej postavy.",
					 "source":"Lukáš 19:1‭-‬3 SEBDT"
				  }
			   },
			   "credentials":"testCredentials"
			}
			*/
			//debug("1");
			const playerManager = context.getPlayerManager();
			//debug("2");
			// Handle incoming messages
			playerManager.setMessageInterceptor(
			  cast.framework.messages.MessageType.LOAD,
			  request => {		
				if (request.media && request.media.customData) {			
				
					const customDataStr = JSON.stringify(request.media.customData);
					debug("CustomData: " + customDataStr);
					
					const customData = JSON.parse(customDataStr);
					debug("CustomData obj: " + JSON.stringify(customData));

					debug("...PARSED...");
					
					
					if(customData.debug) {
						document.getElementById('debug').classList.remove('hiddenMy');
					}
					
					if(!customData.target || customData.target == 'splash') {
						fadeToSplash();
						return;
					} else if(customData.target == 'black') {
						fadeToBlack();
						return;
					} else if(customData.target == 'verse') {
						// TODO: try animated verse swap: https://alvarotrigo.com/blog/css-text-animations/
						if(customData.style) {
							document.getElementById('verse').innerHTML = customData.message;
						} else {
							document.getElementById('verse').textContent = customData.message;
						}
																
						if(customData.source) {
							document.getElementById('source').textContent = customData.source;
						} else {
							document.getElementById('source').textContent = "";
						}				
						
						if(customData.style) { 
							setVerseStyle(customData.style);
						}
						
						fadeToVerse();
					} else if(customData.target == "announcements") {
					    if(customData.style) { 
							setAnnouncementStyle(customData.style);
						}
						
						if(customData.style) {
							document.getElementById('announcement').innerHTML = customData.message;
						} else {
							document.getElementById('announcement').textContent = customData.message;
						}
												
						fadeToAnnouncement();
					}
					
					if(customData.demo && customData.demo === "true") {
						removeClassByQuerySelector('.demoText', 'hiddenMy');
					} else {
						addClassByQuerySelector('.demoText', 'hiddenMy');
					}

					debug("Target: " + customData.target);
					
					if(customData.size) {
						setSize(customData.size);
					}			
					
					debug("...DONE");
					//document.getElementById('welcome').classList.add('hidden');
					//document.querySelector('verses').classList.remove('hidden');
				}
			  }
			);
			//debug("3");
			/*
			context.addCustomMessageListener('urn:x-cast:sk.maniacs.versecast', function(event) {
			  // Get the message data from the event
			  const message = event.data;

			  // Update the text message with the received data
			  const messageElement = document.querySelector('.message');
			  messageElement.textContent = message.msg;
			});
			*/
			const messageEl = document.getElementById('message');
			messageEl.textContent = "Present verses with Chromecast!";

			//debug("4");
			// Start the receiver
			//context.start();
			context.start({disableIdleTimeout: true});

			//debug("5");
			fadeToSplash();	

			debug("Init done...")
			/*
			// Get the video element
			const video = document.getElementById('video');

			// Add a listener for the PLAYING event
			video.addEventListener('playing', function(event) {
			  // Hide the text message when the video starts playing
			  //const messageEl = document.querySelector('.welcomme');
			  //messageEl.style.display = 'none';
			  const message = event.type;
			  const messageEl = document.querySelector('.message');
			  messageEl.textContent = message;
			  //console.log("Tam tam taaam");
			  
			  
			});

			// Add a listener for the PAUSED event
			video.addEventListener('pause', function() {
			  // Show the text message when the video is paused
			  const messageEl = document.querySelector('.welcomme');      
			  messageEl.style.display = 'flex';
			});
			*/
			/*
			// Add a message listener to handle incoming messages
			context.addCustomMessageListener('urn:x-cast:com.example.custom', function(event) {
			  // Get the message data from the event
			  //const message = event.data;

			  // Update the text message with the received data
			  const messageEl = document.querySelector('.message');
			  messageEl.textContent = "turums tu rum tututu";
			  console.log("Tam tam taaam");
			});


			const messageEl = document.querySelector('.message');
			messageEl.textContent = "Uitajte!";


			// Start the receiver
			context.start();
			*/
		</script>
	</body>
</html>