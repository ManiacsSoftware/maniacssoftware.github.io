<!DOCTYPE html>
<html>
	<head>
		<title>Chromecast Receiver</title>
		<meta charset="utf-8"/>
		<link rel="stylesheet" href="main.css"/>
		<!--link href="https://fonts.googleapis.com/css?family=Over+the+Rainbow" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Ballet" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet"-->
		<style id="verseStyle">
		/* CSS styles for the text message */
		/*
		.welcomme {
		  position: absolute;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  #font-size: 36px;
		  #font-weight: bold;
		  color: #ffffff;
		  background-color: rgba(0, 0, 0, 0);
		  z-index: 999;
		}
		*/
		/* for debug resons */
		 .verse.v2 { display: initial !important; margin-right: 0.2em; } 
	    
		</style>
		<style id="songStyle">
		</style>
		<style id="announcementStyle">
		</style>
		<link id="templateStyle" rel="stylesheet" href="backgrounds/blank.css" title="temaplateStyle"/>
	</head>
	<body onload="startTime()" id="rootElement">
		<!-- The video player -->
		<!--video id="video">controls autoplay</video-->
		<!--cast-media-player style="display: none"></cast-media-player-->
		<cast-media-player style="opacity: 0"></cast-media-player>
		<!--cast-media-player></cast-media-player-->
		<embed id="background" class="screen" type="text/html" src="backgrounds/black.html" style="width:100%;height:100vh;"></embed>
		<div id="blackground" class="screen dimable fit enabled"></div>
		<div id="splash" class="dimable">
			<object data="backgrounds/intro.html" class="screen fit" style="width:100%;height:100vh;"></object>
			<div id="welcome" class="centered centertext">
				<h1 id="title">VerseCast</h1>
				<p id="message">Loading...</p>
			</div>
		</div>
		<div id="announcements" class="screen dimable">
			<div class="frame centered">
				<div id="announcement" class="inframe fit sizable">
				</div>
			</div>
			<div id="footer">
				<span class="demoText hiddenMy">VerseCast for Chromecast</span>
				<span/>
			</div>
		</div>
		<div id="verses" class="screen dimable">
			<div class="frame centered">
				<div id="verse" class="inframe centertext fit sizable">
					<div class="version vid465 iso6393slk" data-vid="465" data-iso6393="slk">
						<div class="book bkPSA">
							<div class="chapter ch23" data-usfm="PSA.23">
								<div class="label">23</div>
								<div class="s1">
									<span class="heading">Hospodin je m&#244;j pastier</span>
								</div>
								<div class="d">
									<span class="content">  </span>
									<span class="verse v1" data-usfm="PSA.23.1">
										<span class="label">1</span>
										<span class="content">D&#225;vidov &#382;alm.</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v1" data-usfm="PSA.23.1">
										<span class="content">Hospodin je m&#244;j pastier, ni&#269; mi nech&#253;ba.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">Iz 40,11; Jn 10,11.30</span>
										</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v1" data-usfm="PSA.23.1">
										<span class="content">  </span>
									</span>
									<span class="verse v2" data-usfm="PSA.23.2">
										<span class="label">2</span>
										<span class="content">Vod&#237; ma na zelen&#233; pastviny,</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v2" data-usfm="PSA.23.2">
										<span class="content">priv&#225;dza ma k tich&#253;m vod&#225;m.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">Ez 34,13-14; Zj 7,17</span>
										</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v2" data-usfm="PSA.23.2">
										<span class="content">  </span>
									</span>
									<span class="verse v3" data-usfm="PSA.23.3">
										<span class="label">3</span>
										<span class="content">Obnovuje mi &#382;ivot,</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v3" data-usfm="PSA.23.3">
										<span class="content">vod&#237; ma spr&#225;vnymi cestami</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v3" data-usfm="PSA.23.3">
										<span class="content">pre svoje meno.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">Jer 31,25; Mt 11,28</span>
										</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v3" data-usfm="PSA.23.3">
										<span class="content">  </span>
									</span>
									<span class="verse v4" data-usfm="PSA.23.4">
										<span class="label">4</span>
										<span class="content">Hoc by som &#353;iel temn&#253;m &#250;dol&#237;m,</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v4" data-usfm="PSA.23.4">
										<span class="content">nebudem sa b&#225;&#357; zl&#233;ho.</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v4" data-usfm="PSA.23.4">
										<span class="content">Ve&#271; ty si so mnou,</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v4" data-usfm="PSA.23.4">
										<span class="content">tvoj pr&#250;t a tvoja palica s&#250; mi &#250;techou.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">&#381; 46,3; Rim 8,31</span>
										</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v4" data-usfm="PSA.23.4">
										<span class="content">  </span>
									</span>
									<span class="verse v5" data-usfm="PSA.23.5">
										<span class="label">5</span>
										<span class="content">Prestiera&#353; mi st&#244;l</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v5" data-usfm="PSA.23.5">
										<span class="content">pred mojimi protivn&#237;kmi,</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v5" data-usfm="PSA.23.5">
										<span class="content">hlavu mi natiera&#353; olejom,</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v5" data-usfm="PSA.23.5">
										<span class="content">m&#244;j kalich pretek&#225;.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">&#381; 36,9; 92,11; Lk 7,44-46</span>
										</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v5" data-usfm="PSA.23.5">
										<span class="content">  </span>
									</span>
									<span class="verse v6" data-usfm="PSA.23.6">
										<span class="label">6</span>
										<span class="content">&#193;no, dobrota a milos&#357; bud&#250; ma sprev&#225;dza&#357;</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v6" data-usfm="PSA.23.6">
										<span class="content">po v&#353;etky dni m&#244;jho &#382;ivota.</span>
									</span>
								</div>
								<div class="q1">
									<span class="verse v6" data-usfm="PSA.23.6">
										<span class="content">Vraca&#357; sa budem</span>
										<span class="note f">
											<span class="label">#</span>
											<span class=" body">
												<span class="fr">23,6 </span>
												<span class="ft">Rkp. budem b&#253;va&#357; (LXX, Vg).</span>
											</span>
										</span>
										<span class="content"> do Hospodinovho domu,</span>
									</span>
								</div>
								<div class="q2">
									<span class="verse v6" data-usfm="PSA.23.6">
										<span class="content">pokia&#318; budem &#382;i&#357;.</span>
										<span class="note x">
											<span class="label">#</span>
											<span class=" body">&#381; 84,5</span>
										</span>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div id="footer">
				<span class="demoText hiddenMy">VerseCast for Chromecast</span>
				<span/>
				<span id="source">2 Timothy 4:2 NIV</span>
			</div>
		</div>
		<div id="songs" class="screen dimable">
			<div class="frame centered">
				<div id="song" class="inframe centertext fit sizable">
					<div>
						<span>NOTIFIKÁCIA DOLE ZNAMENÁ</span>
					</div>
					<div>
						<span>ŽE TÁTO PIESEŇ BOLA IMPORTOVANÁ</span>
					</div>
					<div>
						<span>A MOŽNO POTREBUJE SKONTROLOVAŤ ROZLOŽENIE.</span>
					</div>
					<div>
						<span>PO ULOŽENÍ PIESNE SA INDIKÁTOR</span>
					</div>
					<div>
						<span>ZMENÍ NA "PRIPRAVENÉ"</span>
					</div>
				</div>
			</div>
			<div id="song-footer">
				<span class="demoText hiddenMy">VerseCast for Chromecast</span>
				<span/>
				<span id="song-source"></span>
			</div>
		</div>
		<div id="timers" class="screen dimable">
			<div class="frame centered">
				<div id="timer" class="inframe centertext fit sizable">
					<div id="countdown" class="dimable zeroSize">
						<span id="hours"></span><span id="minutes"></span><span id="seconds"></span>
					</div>
					<div id="timerMessage"></div>
				</div>
			</div>
			<div id="timer-footer">
				<span class="demoText hiddenMy">VerseCast for Chromecast</span>
				<span/>
				<span class="clock"></span>
			</div>
		</div>
		<div id="black" class="screen dimable fit enabled"></div>
		<div id="debug" class="screen hiddenMy fit">Debug</div>
		<!-- Include the Cast Receiver SDK -->
		<script type="text/javascript" src="ui.js"></script>
		<script type="text/javascript" src="theme.js"></script>
		<script type="text/javascript" src="time.js"></script>
		<script type="text/javascript" src="http://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
		<!-- Initialize the CastReceiverContext -->
		<script type="text/javascript">
			window.addEventListener('load', function () {
				debug("load finished");
			});
			//showDebug();
			debug("Starting...");

			//fadeToVerse();

			// Create a CastReceiverContext
			const context = cast.framework.CastReceiverContext.getInstance();

			//debug("1");
			const playerManager = context.getPlayerManager();
			//debug("2");
			// Handle incoming messages
			playerManager.setMessageInterceptor(
			  cast.framework.messages.MessageType.LOAD,
			  request => {		
				if (request.media && request.media.customData) {			
				
					const customDataStr = JSON.stringify(request.media.customData);
					//debug("CustomData: " + customDataStr);
					
					const customData = JSON.parse(customDataStr);
					//debug("CustomData obj: " + JSON.stringify(customData));

					debug("...PARSED...");
					
					
					if(customData.debug) {
						document.getElementById('debug').classList.remove('hiddenMy');
					}
					
					if(!customData.target || customData.target == 'splash') {
						fadeToSplash();
						return;
					} else if(customData.target == 'black') {
						fadeToBlack();
						return;
					} else if(customData.target == 'background') {
						fadeToBackground();
						return;
					} else if(customData.target == 'song') {
						fadeToSong();
						// TODO: try animated verse swap: https://alvarotrigo.com/blog/css-text-animations/
						debug("a1");
						if(customData.style) {
							document.getElementById('song').innerHTML = customData.message;
						} else {
							document.getElementById('song').textContent = customData.message;
						}
						debug("a2");							
						if(customData.source) {
							document.getElementById('song-source').textContent = customData.source;
						} else {
							document.getElementById('song-source').textContent = "";
						}				
						debug("a3");
						if(customData.style) { 
							setSongStyle(customData.style);
						}
						debug("a4");
												
						if(customData.size) {
							setSongSize(customData.size);
						}	
						
					} else if(customData.target == 'verse') {
						fadeToVerse();
						// TODO: try animated verse swap: https://alvarotrigo.com/blog/css-text-animations/
						debug("b1");
						if(customData.style) {
							document.getElementById('verse').innerHTML = customData.message;
						} else {
							document.getElementById('verse').textContent = customData.message;
						}
						debug("b2");							
						if(customData.source) {
							document.getElementById('source').textContent = customData.source;
						} else {
							document.getElementById('source').textContent = "";
						}				
						debug("b3");
						if(customData.style) { 
							setVerseStyle(customData.style);
						}
						debug("b4");
						
						
						if(customData.size) {
							setVerseSize(customData.size);
						}	
						
					} else if(customData.target == "announcements") {
						fadeToAnnouncement();
						debug("c1");
					    if(customData.style) { 
							setAnnouncementStyle(customData.style);
						}
						debug("c2");
						if(customData.style) {
							document.getElementById('announcement').innerHTML = customData.message;
						} else {
							document.getElementById('announcement').textContent = customData.message;
						}
						debug("c3");	

						if(customData.size) {
							setAnnouncementSize(customData.size);
						}							
					} else if(customData.target == "timer") {
						fadeToTimer();
						debug("d1");
						if(customData.message) {
							document.getElementById('timerMessage').innerHTML = customData.message;
						} else {
							document.getElementById('timerMessage').textContent = customData.message;
						}
						debug("d2");
						
						startCountdown(customData.source);
						
						debug("d3");


						if(customData.size) {
							setTimerSize(customData.size);
						}	
					}
					
					setDemo(customData.demo && customData.demo === "true");
										
					if(customData.background) {
						debug("x1");
						loadBackground(customData.background);
					} else {
						debug("x2");
						clearBackground();
					}
					
					if(customData.onblack && customData.onblack === "true") {
						disableBackground();
					} else {
						enableBackground();
					}

					debug("Target: " + customData.target);								
					debug("...DONE");
				}
			  }
			);
			//debug("3");
			const messageEl = document.getElementById('message');
			messageEl.textContent = "Present verses with Chromecast!";

			//debug("4");
			// Start the receiver
			context.start({disableIdleTimeout: true});

			debug("Init done...");
		</script>
	</body>
</html>